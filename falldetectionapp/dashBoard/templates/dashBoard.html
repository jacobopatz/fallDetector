<!DOCTYPE html>
<html lang="en">
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fall Detection Dashboard</title>
    <link rel="stylesheet" href="{% static 'dashBoard/css/dashBoard.css' %}">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Fall Detection Dashboard</h1>

            <div class="button-container">
                <form method="post" action="{% url 'logout' %}">
                    {% csrf_token %}
                    <button class="button" type="submit">Log Out</button>
                </form>
                <form method="post" action="{% url 'registerPatient' %}">
                    {% csrf_token %}
                    <button class="button" type="submit">Register Patient</button>
                </form>    
            </div>
        </header>

        <main>
            <!-- User Information -->
            <section class="user-info">
                <h2>User Details</h2>
                <p><strong>Name:</strong> John Doe</p>
                <p><strong>Age:</strong> 78</p>
                <p><strong>Device Status:</strong> Active</p>
            </section>

            <!-- Fall Alerts Section -->
            <section class="fall-alerts">
                <h2>Recent Fall Alert</h2>
                {% if message %}
                    {% if message.has_fallen %}
                        <div class="alerts">
                            <p><strong>ðŸš¨ Fall Detected!</strong></p>
                            <p><strong>Time:</strong> {{ message.timestamp|date:"h:i A" }}</p>
                        </div>
                    {% else %}
                        <div class="alerts" style="background-color: green;">
                            <p><strong>âœ… No Fall Detected</strong></p>
                            <p><strong>Time:</strong> {{ message.timestamp|date:"h:i A" }}</p>
                        </div>
                    {% endif %}
                {% else %}
                    <p>No fall data available.</p>
                {% endif %}
            </section>

            <!-- Real-Time Status Section -->
            <section class="real-time-status">
                <h2>Real-Time Status</h2>
                <p>Last Recorded Movement: <span class="device-status">Normal</span></p>
                <p>Battery Level: <span class="device-status">85%</span></p>
            </section>
        </main>
    </div>
    <script>
        function checkFall() {
          fetch('/API/check-fall/')
            .then(response => response.json())
            .then(data => {
              const alertSection = document.querySelector('.fall-alerts .alerts');
              const section = document.querySelector('.fall-alerts');
              const timestamp = data.timestamp || "N/A";
      
              if (data.has_fallen) {
                section.innerHTML = `
                  <h2>Recent Fall Alert</h2>
                  <div class="alerts" style="background-color: red; color: white;">
                    <form method="post" action="/API/clear-fall/">
                        {% csrf_token %}
                        <input type="hidden" name="timestamp" value="{{ message.timestamp|date:'c' }}">
                        <input type="hidden" name="has_fallen" value="False">
                        <button type="submit" class="button" style="margin-top: 10px;">Clear Fall Alert</button>
                    </form>
                    <p><strong>ðŸš¨ Fall Detected!</strong></p>
                    <p><strong>Time:</strong> ${timestamp}</p>
                  </div>`;
              } else {
                section.innerHTML = `
                  <h2>Recent Fall Alert</h2>
                  <div class="alerts" style="background-color: green; color: white;">
                    <p><strong>âœ… No Fall Detected</strong></p>
                    <p><strong>Time:</strong> ${timestamp}</p>
                  </div>`;
              }
            });
        }
      
        // Poll every 5 seconds
        setInterval(checkFall, 5000);
        checkFall(); // Initial check
      </script>
      
</body>
</html>